<!DOCTYPE html>
<!-- Project page http://github.com/mrtimuk/sierpinski -->
<html>
<head>
<meta charset="utf-8"/>
<title>Sierpinski Fractals</title>
</head>

<body>
<script type="text/javascript">
	// Create a canvas if we can, otherwise use svg
	const elem = document.createElement('canvas');
	const useSvg = 0;
	if (!elem) {
		elem = document.createElement('svg');
		useSvg = 1;
	}
	elem.setAttribute("id","canvas");
	elem.width = elem.height = 600;
	elem.style.width = elem.style.height = "600px";
	elem.style.float = "left";
	document.body.appendChild(elem);
</script>

<div style="float:left; padding: 10px">
<div>
	<p>
		Iterations:<br> 
		<input onkeyup="render()" id="iters" value="3" maxLength="1" size="1" />
		<button id="decr">-</button>
		<button id="incr">+</button>
	</p>
	<p>
		Pattern:<br>
		<input id="c00" type="checkbox" checked="1" />
		<input id="c01" type="checkbox" checked="1" />
		<input id="c02" type="checkbox" checked="1" />
		<input id="c03" type="checkbox" checked="1" />
		<br>
		<input id="c10" type="checkbox" />
		<input id="c11" type="checkbox" checked="1" />
		<input id="c12" type="checkbox" />
		<input id="c13" type="checkbox" checked="1" />
		<br>
		<input id="c20" type="checkbox" />
		<input id="c21" type="checkbox" />
		<input id="c22" type="checkbox" checked="1" />
		<input id="c23" type="checkbox" checked="1" />
		<br>
		<input id="c30" type="checkbox" />
		<input id="c31" type="checkbox" />
		<input id="c32" type="checkbox" />
		<input id="c33" type="checkbox" checked="1" />
	</p>
</div>

<div style="margin-top:150px">
	<a href="http://github.com/mrtimuk/sierpinski" style="color:grey">http://github.com/mrtimuk/sierpinski</a>
</div>
</div>

<script type="text/javascript">
	const xmlns = "http://www.w3.org/2000/svg";
	const canvas = document.getElementById('canvas');
	const elIters = document.getElementById('iters');

	document.getElementById("incr").addEventListener("click", () => {
		elIters.value++;
		render();
	});
	document.getElementById("decr").addEventListener("click", () => {
		if (elIters.value > 0) { elIters.value--; }
		render();
	});

	function render() {
		const size = canvas.width;

		let pattern = [[],[],[],[]];
		for (let j = 0; j < 4; j++){
			for (let i = 0; i < 4; i++) {
				pattern[i][j] = document.getElementById("c"+j+i).checked;
			}
		}

		clear();
		fractal(pattern, 0, 0, size, canvas, elIters.value);
	}

	for (let j = 0; j < 4; j++){
		for (let i = 0; i < 4; i++) {
			document.getElementById("c"+j+i).addEventListener("click", render);
		}}

	function fractal(pattern, x, y, size, canvas, n) {
		if (n == 0 || size == 1) {
			pixel(x, y, size, canvas);
		} else {
			size = size/4;
			for (let j = 0; j < 4; j++){
				for (let i = 0; i < 4; i++) {
					if (pattern[i][j]) {
						fractal(pattern, x+size*i, y+size*j, size, canvas, n-1);
					}
				}
			}
		}
	}

	function clear() {
		if (useSvg) {
			cont.innerHTML = '';
		} else {
			var ctx = canvas.getContext("2d");
			ctx.imageSmoothingEnabled= false
			ctx.fillStyle = '#fff';
			ctx.fillRect (0,0,canvas.width,canvas.height);
			ctx.fillStyle = '#008';
		} 
	}

	function pixel(x, y, size, canvas) {
		if (useSvg) {
			var rect = document.createElementNS(xmlns, 'rect');
			rect.setAttribute('x', x );
			rect.setAttribute('y', y );
			rect.setAttribute('width', size);
			rect.setAttribute('height', size);
			rect.setAttribute('style', 'fill:rgb(0,0,128);');
			cont.appendChild(rect);
		} else {
			var ctx = canvas.getContext("2d");
			ctx.fillRect(x,y,size,size);
		}
	}
	render();
</script>
</body>
</html>
